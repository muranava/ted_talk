#!/usr/bin/env ruby
# -*- coding: utf-8 -*-

$:.unshift File.join(File.dirname(__FILE__), '..', 'lib')
require 'rubygems'
require 'trollop'
require 'ted_talk'

################ parse options ##########

opts = Trollop::options do
  version TedTalk::VERSION
  banner <<-EOS
  
TedTalk helps download TED talk video and covert it to MP3 that can be conveniently used for English learning.

Usage: ted_talk [options] <source url>
where: <source url> is something like "http://www.ted.com/talks/xxx_xxx_xxx.html"

[options]:
EOS

  opt :lang, "Language of description and bilingual transcript", :default => "en"
  opt :outdir, "Directory for file output", :default=> "./"
  opt :silence, "Number of seconds after each speech phrase", :default => 0
  opt :desc, "Show descriptions of the talk", :default => false

end
Trollop::die :outdir, "must be an existing directory" unless File::ftype(opts[:outdir]) == "directory"
Trollop::die :silence, "must be 0 or a larger integer" if opts[:silence] < 0

############### main program ############### 

if ARGV.size != 1
  puts "A valide source URL must be set properly"
  exit
end

source_url = ARGV[0]
outdir     = opts[:outdir]
silence    = opts[:silence]
lang       = opts[:lang]

tedtalk = TedTalk::Converter.new(source_url, outdir)

if opts[:desc]
  tedtalk.desc(lang)
else
  tedtalk.execute(silence, lang)
end

# url = "http://www.ted.com/talks/steven_addis_a_father_daughter_bond_one_photo_at_a_time.html"
# url = "http://www.ted.com/talks/jonathan_haidt_on_the_moral_mind.html"
# url = "http://www.ted.com/talks/susan_cain_the_power_of_introverts.html"
# url = "http://www.ted.com/talks/amy_cuddy_your_body_language_shapes_who_you_are.html"
# url = "http://www.ted.com/talks/ken_robinson_says_schools_kill_creativity.html"
# url = "http://www.ted.com/talks/pranav_mistry_the_thrilling_potential_of_sixthsense_technology.html"
# url = "http://www.ted.com/talks/rives_reinventing_the_encyclopedia_game.html"
# url = "http://www.ted.com/talks/hans_rosling_and_the_magic_washing_machine.html"
# url = "http://www.ted.com/talks/israel_and_iran_a_love_story.html"
# url = "http://www.ted.com/talks/lemon_andersen_performs_please_don_t_take_my_air_jordans.html"
# url = "http://www.ted.com/talks/j_j_abrams_mystery_box.html"
# url = "http://www.ted.com/talks/robert_gupta_between_music_and_medicine.html"


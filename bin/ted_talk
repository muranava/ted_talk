#!/usr/bin/env ruby
# -*- coding: utf-8 -*-

$:.unshift File.join(File.dirname(__FILE__), '..', 'lib')
require 'rubygems'
require 'trollop'
require 'ted_talk'

################ parse options ##########

opts = Trollop::options do
  version TedTalk::VERSION
  banner <<-EOS
  
TedTalk helps download TED talk video and covert it to a slowed down MP3 with pauses that is helpful for English learning.

Usage: ted_talk [options] <source url>
where: <source url> is something like "http://www.ted.com/talks/xxx_xxx_xxx.html"

[options]:
EOS

  opt :lang, "Language of description and bilingual transcript", :default => "en"
  opt :outdir, "Directory for file output", :default=> "./"
  opt :speed, "Speed of output file [0.1 - 100]", :default => 1.0
  opt :silence, "Length (secondes) of a pause added to each utterance [0.1 - 120]", :default => 0.0
  opt :desc, "Show descriptions of the talk", :default => false
  opt :rss, "Show descriptions of the newest talks from TED Talk RSS", :default => false
end

############### main program ############### 

outdir     = opts[:outdir]
speed      = opts[:speed]
silence    = opts[:silence]
lang       = opts[:lang]

if opts[:rss]
  TedTalk.desp_talks_rss(lang)  
  exit
end

if ARGV.size != 1
  puts "A valide source URL must be set properly"
  exit
end

source_url = ARGV[0]

if opts[:desc]
  tedtalk = TedTalk::Converter.new(source_url)
  tedtalk.desc(lang)
  exit
end

Trollop::die :outdir, "must be an existing directory" unless File::ftype(opts[:outdir]) == "directory"
Trollop::die :speed, "must between 0.1 to 100" unless opts[:speed] >= 0.1 and opts[:speed] <= 100
Trollop::die :silence, "must be 0 to 120" unless opts[:silence] >= 0.1 and opts[:silence] <= 120

tedtalk = TedTalk::Converter.new(source_url)

tedtalk.execute(outdir, lang, speed, silence)

# http://www.ted.com/talks/steven_addis_a_father_daughter_bond_one_photo_at_a_time.html
# http://www.ted.com/talks/jonathan_haidt_on_the_moral_mind.html
# http://www.ted.com/talks/susan_cain_the_power_of_introverts.html
# http://www.ted.com/talks/amy_cuddy_your_body_language_shapes_who_you_are.html
# http://www.ted.com/talks/ken_robinson_says_schools_kill_creativity.html
# http://www.ted.com/talks/pranav_mistry_the_thrilling_potential_of_sixthsense_technology.html
# http://www.ted.com/talks/rives_reinventing_the_encyclopedia_game.html
# http://www.ted.com/talks/hans_rosling_and_the_magic_washing_machine.html
# http://www.ted.com/talks/israel_and_iran_a_love_story.html
# http://www.ted.com/talks/lemon_andersen_performs_please_don_t_take_my_air_jordans.html
# http://www.ted.com/talks/j_j_abrams_mystery_box.html
# http://www.ted.com/talks/robert_gupta_between_music_and_medicine.html

